<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <title>æƒ…ç·’æ—¥è¨˜åˆ†æç³»çµ±</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
    <h1>ğŸ“‚ ä¸Šå‚³æ—¥èªŒ</h1>
    <form id="upload-form" enctype="multipart/form-data">
        <input type="file" name="file" required />
        <button type="submit">ä¸Šå‚³ä¸¦åˆ†æ</button>
    </form>

    <h2>ğŸ“Š æƒ…ç·’èµ°å‘åœ–</h2>
    <div id="plot">
        <img id="mood-trend" src="" alt="å¿ƒæƒ…è¶¨å‹¢åœ–å°‡é¡¯ç¤ºæ–¼æ­¤" style="width: 100%; display: none;" />
    </div>

    <h2>ğŸ“ˆ å‰µä½œæ§‹é¢é•·æ¢åœ–</h2>
    <div id="aspect">
        <img id="aspect-bar" src="" alt="æ§‹é¢é•·æ¢åœ–å°‡é¡¯ç¤ºæ–¼æ­¤" style="width: 100%; display: none;" />
    </div>

    <h2>ğŸ§© å³æ™‚åˆ†æé€²åº¦</h2>
    <div id="progress"></div>

    <h2>ğŸ’¡ Gemini çµ¦çš„å»ºè­°</h2>
    <div id="suggestions"></div>

    <script>
        const socket = io();
        const form = document.getElementById('upload-form');
        const progress = document.getElementById('progress');
        const suggestions = document.getElementById('suggestions');
        const moodTrend = document.getElementById('mood-trend');
        const aspectBar = document.getElementById('aspect-bar');

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(form);
            fetch('/upload', { method: 'POST', body: formData });
            progress.innerHTML = 'ğŸŸ¢ æª”æ¡ˆä¸Šå‚³æˆåŠŸï¼Œé–‹å§‹åˆ†æä¸­...';
            suggestions.innerHTML = '';
            moodTrend.style.display = 'none';
            aspectBar.style.display = 'none';
        });

        socket.on('update', function (data) {
            progress.innerHTML += `<p>${data.message}</p>`;
        });

        socket.on('result', function (data) {
            console.log('âœ… æ¥æ”¶åˆ°åˆ†æçµæœï¼š', data);

            // é¡¯ç¤ºæƒ…ç·’åœ–
            moodTrend.src = data.moodtrend_img + '?t=' + new Date().getTime();
            moodTrend.style.display = 'block';

            // é¡¯ç¤ºæ§‹é¢é•·æ¢åœ–
            aspectBar.src = data.aspect_bar_img + '?t=' + new Date().getTime();
            aspectBar.style.display = 'block';

            // é¡¯ç¤º Gemini å»ºè­°
            suggestions.innerHTML = `<pre>${data.ai_feedback}</pre>`;
        });
    </script>
</body>
</html>
